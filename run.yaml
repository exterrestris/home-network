---
# Setup - Common
  - hosts: all
    gather_facts: no
    serial: 1
    tasks:
      - include_tasks: tasks/setup-ansible-user.yaml
        tags: setup

# Setup - Host Specific
  - hosts: memory_alpha
    roles:
      # Update kernel to HWE (5.8) to add support for Renesas USB controller
      - role: alvistack.kernel
        vars:
          kernel_release: "mainline"
        tags:
          - kernel

# Setup - Groups

# Main - Common
  - hosts: all
    tasks:
      - name: install common packages
        package:
          name: "{{ item.name }}"
          state: present
        with_items: "{{ common_packages }}"

# Main - Host Specific
  - hosts: spacedock
    roles:

  - hosts: memory_alpha
    roles:
      - role: exterrestris.ansible_users
        tags:
          - users

  - hosts: memory_beta
    roles:
      - role: exterrestris.ansible_users
        tags:
          - users

# Main - Groups
  - hosts: proxmox_host
    roles:
      - role: ironicbadger.ansible_role_proxmox_nag_removal
      - role: proxmox_host
        tags: proxmox
      - role: exterrestris.proxmox_ssl
        tags: ssl
        
  - hosts: proxmox_vm
    roles:
      - role: proxmox_vm

  - hosts: nas
    roles:
      - role: mount_disks
      - role: mrlesmithjr.zfs
        tags:
          - disks
          - zfs
      - role: sprat.ansible_role_mergerfs
        tags:
          - disks
          - mergerfs
      - role: bertvv.samba
        tags:
          - samba
      - role: geerlingguy.docker
        tags:
          - docker
      - role: ironicbadger.ansible_role_snapraid
        tags:
          - snapraid
      - role: weareinteractive.ufw
      - role: exterrestris.ansible_role_wsdd
