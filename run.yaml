---
  - hosts: all
    tasks:
      - name: install common packages
        package:
          name: "{{ item.name }}"
          state: present
        with_items: "{{ common_packages }}"

  - hosts: spacedock
    roles:
      - role: ironicbadger.ansible_role_proxmox_nag_removal
      - role: proxmox_host
        tags: proxmox
      - role: exterrestris.proxmox_ssl
        tags: ssl

  - hosts: memory_alpha
    roles:
      - role: exterrestris.ansible_users
        tags:
          - users
      - role: proxmox_vm
      # Update kernel to HWE (5.8) to add support for Renesas USB controller
      - role: alvistack.kernel
        vars:
          kernel_release: "mainline"
        tags: kernel
      - role: mount_disks
      - role: mrlesmithjr.zfs
        tags:
          - disks
          - zfs
      - role: sprat.ansible_role_mergerfs
        tags:
          - disks
          - mergerfs
      - role: bertvv.samba
        tags:
          - samba
      - role: geerlingguy.docker
        tags:
          - docker
      - role: ironicbadger.ansible_role_snapraid
        tags:
          - snapraid
      - role: weareinteractive.ufw
      - role: exterrestris.ansible_role_wsdd

  - hosts: memory_beta
    roles:
      - role: exterrestris.ansible_users
        tags:
          - users
      - role: mount_disks
      - role: mrlesmithjr.zfs
        tags:
          - disks
          - zfs
      - role: sprat.ansible_role_mergerfs
        tags:
          - disks
          - mergerfs
      - role: bertvv.samba
        tags:
          - samba
      - role: geerlingguy.docker
        tags:
          - docker
      - role: ironicbadger.ansible_role_snapraid
        tags:
          - snapraid
      - role: weareinteractive.ufw
      - role: exterrestris.ansible_role_wsdd
