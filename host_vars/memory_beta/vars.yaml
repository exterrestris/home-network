---
target_os: ubuntu

users:
  - username: sean
    name: Sean Ellingham
    groups:
      - 'sudo'
      - 'backups'
      - 'media'
      - 'scans'
      - 'archive'
      - 'resources'
    github_username: exterrestris
    password: $6$CVT.SP2GSSu/sbE7$KioDey0lx2KQ3KLoTuylnCwoIFnTkO9gc169sSOn1MePHjs6MBzI/E38qkJ6Hq0mYtYODrcLvZM8iqnkhbGh01
    update_password: on_create
  - username: scans
    group: scans

groups_to_create:
  - name: backups
  - name: media
  - name: archive
  - name: downloads
  - name: resources
  - name: scans

zfs_ubuntu_universe_repo_url: http://ports.ubuntu.com/ubuntu-ports

zfs_create_pools: true

zfs_pools:
  - name: backup1
    action: 'create'
    compression: 'lz4'
    devices:
      # USB dock doesn't expose disk IDs - using partition UUIDs
      - '1d63c541-3a7b-45ce-a2a2-dc96cecf8d11'
      - 'c2101a06-81ad-4194-b32f-3962b92b9b00'
    type: 'mirror'
    state: 'present'

zfs_create_filesystems: true

zfs_filesystems:
  - name: backups
    pool: backup1
    compression: lz4
    mountpoint: /mnt/zfs/backups
    state: present
  - name: backups/computers
    pool: backup1
    compression: lz4
    recordsize: 1M
    mountpoint: /mnt/zfs/backups/computers
    state: present
  - name: backups/drives
    pool: backup1
    compression: lz4
    recordsize: 1M
    mountpoint: /mnt/zfs/backups/drives
    state: present
  - name: archive
    pool: backup1
    compression: lz4
    mountpoint: /mnt/zfs/archive
    state: present

parity_disks:
  - path: /mnt/ext4/parity1
    diskbyid: /dev/disk/by-uuid/a8a450d1-c9cd-4a9d-a904-138b793e5135
    fs: ext4
    opts: defaults
    content: true

data_disks:
  - path: /mnt/ext4/backups1
    data_path: /data
    diskbyid: /dev/disk/by-uuid/e5a631ba-6896-46d8-a947-aec2a745e697
    fs: ext4
    opts: defaults
    content: true
  - path: /mnt/ext4/backups2
    data_path: /data
    diskbyid: /dev/disk/by-uuid/e9585a85-0247-4d0d-ae2c-cb5e83fea1eb
    fs: ext4
    opts: defaults
    content: true

other_disks:

ntfs_data_disks:

other_mounts:
  - path: /mnt/zfs

remove_mounts:

# sprat.ansible-role-mergerfs
mergerfs_opts: allow_other,use_ino,cache.files=off,dropcacheonclose=true,category.create=mfs

mergerfs_mounts:
  - path: /mnt/backups
    branches:
      - /mnt/ext4/backups*/data
    options: "{{ mergerfs_opts }},x-systemd.requires=/mnt/ext4/backups1,x-systemd.requires=/mnt/ext4/backups2"

# bertvv.samba
samba_workgroup: FEDERATION
samba_preferred_master: true

samba_users: "{{ vault_samba_users }}"

# Handle Windows not being able to browse shares due to incorrectly applied mitigation (https://github.com/bertvv/ansible-role-samba/issues/62)
samba_mitigate_cve_2017_7494: false

samba_shares:
  - name: Archive
    path: /mnt/zfs/archive
    owner: sean
    group: archive
    mode: '2775'
    writable: 'no'
    guest_ok: 'yes'
  - name: Backups
    path: /mnt/zfs/backups
    owner: sean
    group: backups
    mode: '2775'
    writable: 'no'
    guest_ok: 'yes'
  - name: Old Backups
    path: /mnt/backups
    owner: sean
    group: backups
    mode: '2775'
    writable: 'no'
    guest_ok: 'yes'

wsdd_workgroup: "{{ samba_workgroup }}"

ufw_rules:
  - rule: allow
    name: OpenSSH
  - rule: allow
    name: Samba

# ironicbadger.ansible_role_snapraid
snapraid_email_address: "memory-beta@{{ internal_domain }}"
snapraid_gmail_pass: "{{ vault_snapraid_email_password }}"
snapraid_email_address_to: "{{ vault_snapraid_email_to }}"
snapraid_email_sendon: "success,error"

snapraid_smtp_host: smtp.migadu.com

snapraid_run_command: "python3 {{ snapraid_run_bin }} -c {{ snapraid_run_conf}} > /dev/null"
snapraid_run_scrub_percent: 25
snapraid_run_scrub_age: 10